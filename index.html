<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Serial Keeper</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#fff;
  color:#111;
}
header{
  padding:16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #eee;
}
.badge{
  padding:6px 12px;
  border-radius:999px;
  border:1px solid #ddd;
  font-size:14px;
}
main{
  padding:16px;
}
input{
  width:100%;
  padding:14px;
  font-size:18px;
  border-radius:12px;
  border:1px solid #ddd;
}
.note{
  font-size:12px;
  color:#666;
  margin-top:6px;
}
#camera{
  margin-top:20px;
  border-radius:16px;
  overflow:hidden;
}
video{
  width:100%;
}
.frame{
  position:absolute;
  inset:30% 10%;
  border:3px solid #3b82f6;
  border-radius:14px;
}
.status{
  margin-top:10px;
  font-size:14px;
  color:#555;
}
</style>
</head>

<body>

<header>
  <h2>Serial Keeper</h2>
  <div class="badge" id="inquiryBadge">Inquiry No.: —</div>
</header>

<main>
  <input id="inquiryInput" inputmode="numeric" placeholder="12345-1234567">
  <div class="note">数字5桁 + - + 数字7桁（自動確定）</div>

  <div id="camera">
    <video id="video" autoplay playsinline></video>
    <div class="frame"></div>
  </div>

  <div class="status" id="status">
    問い合わせ番号が確定すると読み取り開始
  </div>
</main>

<script>
let inquiryNo = "";
const input = document.getElementById("inquiryInput");
const badge = document.getElementById("inquiryBadge");
const status = document.getElementById("status");

// 入力監視（Enter不要）
input.addEventListener("input", () => {
  let v = input.value.replace(/[^\d]/g, "");

  if (v.length > 12) v = v.slice(0,12);

  if (v.length > 5) {
    v = v.slice(0,5) + "-" + v.slice(5);
  }

  input.value = v;

  // 完全一致チェック
  if (/^\d{5}-\d{7}$/.test(v)) {
    inquiryNo = v;
    badge.textContent = `Inquiry No.: ${v}`;
    status.textContent = "読み取り待機中（自動保存）";
  } else {
    inquiryNo = "";
    badge.textContent = "Inquiry No.: —";
    status.textContent = "問い合わせ番号が未確定です";
  }
});

// カメラ起動
navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
.then(stream=>{
  document.getElementById("video").srcObject = stream;
});
</script>

</body>
</html>
